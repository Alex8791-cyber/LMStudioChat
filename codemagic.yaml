workflows:
    ios-workflow:
      name: iOS Build
      max_build_duration: 60
      instance_type: mac_mini_m1
      environment:
        xcode: 15.0
      scripts:
        - name: Install XcodeGen
          script: |
            curl -Lo xcodegen.zip https://github.com/yonaskolb/XcodeGen/releases/download/2.38.0/xcodegen.zip
            unzip -o xcodegen.zip
            chmod +x xcodegen
            export PATH="$PWD:$PATH"
            xcodegen --version
        - name: Generate Xcode Project
          script: |
            ./xcodegen generate
        - name: Build iOS App
          script: |
            xcodebuild -project LMStudioChat.xcodeproj \
              -scheme LMStudioChat \
              -sdk iphoneos \
              -configuration Release \
              -archivePath build/LMStudioChat.xcarchive \
              archive \
              CODE_SIGN_IDENTITY="" \
              CODE_SIGNING_REQUIRED=NO \
              CODE_SIGNING_ALLOWED=NO
        - name: Create IPA folder
          script: |
            mkdir -p build/ios/ipa
            cp -r build/LMStudioChat.xcarchive/Products/Applications/*.app build/ios/ipa/ || true
      artifacts:
        - build/ios/ipa
        - build/LMStudioChat.xcarchive
      publishing:
        email:
          recipients:
            - a.s.199191@gmail.com